<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Prescription</title>
    <link rel="stylesheet" href="/css/createPrescription.css">
</head>
<body>
    <!Navigation Bar>
    <%- include('partials/doctorNavbar.ejs') %>
    
    <div class="container">
        <h1>Create Prescription</h1>
        <form id="prescription-form">
            <input type="hidden" id="studentId" name="studentId">
            
            <div class="form-group">
                <label for="diagnosis">Diagnosis</label>
                <input type="text" id="diagnosis" name="diagnosis" required>
            </div>
            <div class="form-group">
                <label for="blood-pressure">Blood Pressure</label>
                <input type="text" id="blood-pressure" name="bloodPressure" required>
            </div>
            <div class="form-group">
                <label>Medicines</label>
                <div id="medicine-list" class="medicine-list">
                    <div class="medicine-item">
                        <select name="medicine[]" required>
                            <option value="">Select Medicine</option>
                            <option value="Paracetamol">Paracetamol</option>
                            <option value="Ibuprofen">Ibuprofen</option>
                            <option value="Amoxicillin">Amoxicillin</option>
                        </select>
                        <select name="dosage[]" required>
                            <option value="">Select Dosage</option>
                            <option value="250mg">250mg</option>
                            <option value="500mg">500mg</option>
                            <option value="750mg">750mg</option>
                            <option value="1000mg">1000mg</option>
                        </select>
                        <select name="duration[]" required>
                            <option value="">Select Duration</option>
                            <option value="3 days">3 days</option>
                            <option value="5 days">5 days</option>
                            <option value="7 days">7 days</option>
                            <option value="10 days">10 days</option>
                            <option value="14 days">14 days</option>
                            <option value="1 month">1 month</option>
                            <option value="3 months">3 months</option>
                            <option value="6 months">6 months</option>
                            <option value="Continuous">Continuous</option>
                        </select>
                        <select name="timesPerDay[]" required>
                            <option value="">Times per Day</option>
                            <option value="1">0 + 1 + 0</option>
                            <option value="2">0 + 0 + 1</option>
                            <option value="3">1 + 0 + 0</option>
                            <option value="5">1 + 0 + 1</option>
                            <option value="6">1 + 1 + 0</option>
                            <option value="7">0 + 1 + 1</option>
                            <option value="4">1 + 1 + 1</option>
                        </select>
                        <select name="prepostmeal" id="prepostmeal">
                            <option value="">Pre Post Meal</option>
                            <option value="Before Meal">Before Meal</option>
                            <option value="After Meal">After Meal</option>
                        </select>
                        <button type="button" onclick="removeMedicineRow(this)">Remove</button>
                    </div>
                </div>
                <button type="button" onclick="addMedicineRow()">Add Medicine</button>
            </div>

            <div class="form-group">
                <label for="notes">Instructions</label>
                <textarea id="notes" name="notes" rows="4" placeholder="Enter any additional instructions"></textarea>
            </div>

            <div class="form-actions">
                <button type="submit">Submit Prescription</button>
            </div>
        </form>
    </div>

    <script>
        // Get student ID from URL parameter
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const studentId = urlParams.get('studentId');
            if (studentId) {
                document.getElementById('studentId').value = studentId;
            }
        });
        
        function addMedicineRow() {
            const medicineList = document.getElementById("medicine-list");
            const medicineItem = document.createElement("div");
            medicineItem.className = "medicine-item";

            medicineItem.innerHTML = `
                <select name="medicine[]" required>
                    <option value="">Select Medicine</option>
                    <option value="Paracetamol">Paracetamol</option>
                    <option value="Ibuprofen">Ibuprofen</option>
                    <option value="Amoxicillin">Amoxicillin</option>
                </select>
                <select name="dosage[]" required>
                    <option value="">Select Dosage</option>
                    <option value="250mg">250mg</option>
                    <option value="500mg">500mg</option>
                    <option value="750mg">750mg</option>
                    <option value="1000mg">1000mg</option>
                </select>
                <select name="duration[]" required>
                    <option value="">Select Duration</option>
                    <option value="3 days">3 days</option>
                    <option value="5 days">5 days</option>
                    <option value="7 days">7 days</option>
                    <option value="10 days">10 days</option>
                    <option value="14 days">14 days</option>
                    <option value="1 month">1 month</option>
                    <option value="3 months">3 months</option>
                    <option value="6 months">6 months</option>
                    <option value="Continuous">Continuous</option>
                </select>
                <select name="timesPerDay[]" required>
                    <option value="">Times per Day</option>
                    <option value="1">0 + 1 + 0</option>
                    <option value="2">0 + 0 + 1</option>
                    <option value="3">1 + 0 + 0</option>
                    <option value="5">1 + 0 + 1</option>
                    <option value="6">1 + 1 + 0</option>
                    <option value="7">0 + 1 + 1</option>
                    <option value="4">1 + 1 + 1</option>
                </select>
                <select name="prepostmeal" id="prepostmeal">
                    <option value="">Pre Post Meal</option>
                    <option value="Before Meal">Before Meal</option>
                    <option value="After Meal">After Meal</option>
                </select>
                <button type="button" onclick="removeMedicineRow(this)">Remove</button>
            `;

            medicineList.appendChild(medicineItem);
        }

        function removeMedicineRow(button) {
            button.parentElement.remove();
        }
        
        // Add form submission handler
        document.getElementById('prescription-form').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Collect form data
            const formData = new FormData(this);
            const data = {
                studentId: formData.get('studentId'),
                diagnosis: formData.get('diagnosis'),
                bloodPressure: formData.get('bloodPressure'),
                notes: formData.get('notes'),
                medicines: []
            };
            
            // Get all medicines
            const medicineElements = document.querySelectorAll('.medicine-item');
            medicineElements.forEach((element, index) => {
                data.medicines.push({
                    medicine: formData.getAll('medicine[]')[index],
                    dosage: formData.getAll('dosage[]')[index],
                    duration: formData.getAll('duration[]')[index],
                    timesPerDay: formData.getAll('timesPerDay[]')[index],
                    prepostmeal: formData.getAll('prepostmeal')[index]
                });
            });
            
            // TODO: Send data to server (will be implemented later)
            console.log('Prescription data:', data);
            alert('Prescription created successfully!');
        });
    </script>
</body>
</html>